<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Classical Composer Generator</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        #composer-info { margin-top: 20px; display: grid; grid-template-columns: 300px 1fr; gap: 20px; text-align: left; }
        .composer-image { max-width: 100%; height: auto; }
        .composer-details { padding: 10px; }
        audio { margin-top: 10px; width: 100%; }
    </style>
</head>
<body>
    <h1>Random Classical Composer Generator</h1>
    <button onclick="generateComposer()">Generate Composer</button>
    <div id="composer-info"></div>

    <script>
        const periods = ['baroque', 'classical', 'romantic', 'impressionist', 'neoclassical'];
        
        async function getRandomComposer() {
            const randomPeriod = periods[Math.floor(Math.random() * periods.length)];
            const response = await fetch(`https://api.openopus.org/composer/list/period/${randomPeriod}.json`);
            const data = await response.json();
            return data.composers[Math.floor(Math.random() * data.composers.length)];
        }

        async function getComposerDetails(id) {
            const response = await fetch(`https://api.openopus.org/composer/${id}.json`);
            return response.json();
        }

        async function generateComposer() {
            const container = document.getElementById('composer-info');
            container.innerHTML = 'Loading...';

            try {
                const composer = await getRandomComposer();
                const details = await getComposerDetails(composer.id);
                const works = details.composer.works.slice(0, 20); // Limit to first 20 works
                const randomWork = works[Math.floor(Math.random() * works.length)];
                const spotifyId = randomWork?.recordings?.[0]?.spotify;

                container.innerHTML = `
                    <img class="composer-image" src="${composer.portrait || 'https://via.placeholder.com/300?text=No+Image'}">
                    <div class="composer-details">
                        <h2>${composer.name}</h2>
                        <p><strong>Born:</strong> ${composer.birth}</p>
                        <p><strong>Died:</strong> ${composer.death} (Age ${composer.death - composer.birth})</p>
                        <p><strong>Period:</strong> ${composer.epoch}</p>
                        <p><strong>Random Work:</strong> ${randomWork?.title || 'Not available'}</p>
                        ${spotifyId ? `
                            <audio controls>
                                <source src="https://open.spotify.com/embed/track/${spotifyId}" type="audio/mpeg">
                                Your browser does not support audio
                            </audio>
                        ` : ''}
                        <p>${details.composer.biography.split('\n')[0]}</p>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = 'Error loading composer data';
                console.error(error);
            }
        }
    </script>
</body>
</html>
